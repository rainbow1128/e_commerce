{
    "pid_file" : "tmp/proc/media_server_test.pid",
    "error_log": "tmp/log/staffsite/media_server_test.err",
    "access_log": {
        "path":"tmp/log/staffsite/media_server_test.access.log",
        "format":"%H %h %l %t \"%r\" %s %b"
    },
    "listen": [
        {
            "port": 8010,
            "host":"localhost",
            "ssl":{
                "cert_file"   : "media/data/certs/test/localhost_8010.crt",
                "privkey_file": "media/data/certs/test/localhost_8010.private.key",
                "cipher_suites": "TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384",
                "min_version": 772
            },
            "routes": [
                {"path":"/upload/multipart/initiate", "entry_fn":"initiate_multipart_upload"},
                {"path":"/upload/multipart/part"    , "entry_fn":"upload_part"},
                {"path":"/upload/multipart/complete", "entry_fn":"complete_multipart_upload"},
                {"path":"/upload/multipart/abort"   , "entry_fn":"abort_multipart_upload"},
                {"path":"/upload"        , "entry_fn":"single_chunk_upload"},
                {"path":"/file/transcode", "entry_fn":"start_transcoding_file"},
                {"path":"/job"     , "entry_fn":"discard_ongoing_job"},
                {"path":"/job"     , "entry_fn":"monitor_job_progress"},
                {"path":"/file"    , "entry_fn":"fetch_entire_file"},
                {"path":"/file"    , "entry_fn":"discard_file"},
                {"path":"/file/playback" , "entry_fn":"get_next_media_segment"},
                {"path":"/file/acl", "entry_fn":"edit_file_acl"},
                {"path":"/file/acl", "entry_fn":"read_file_acl"}
            ]
        },
        {
            "port": 8008,
            "host":"localhost",
            "ssl":{
                "cert_file"   : "media/data/certs/test/localhost_8008.crt",
                "privkey_file": "media/data/certs/test/localhost_8008.private.key",
                "cipher_suites": "TLS_AES_128_CCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_CCM_8_SHA256",
                "min_version": 772
            },
            "routes": [
                {"path":"/jwks", "entry_fn":"get_jwks_pubkey"}
            ]
        }
    ],
    "ca":{
        "cert_file"   : "media/data/certs/test/ca.crt",
        "privkey_file": "media/data/certs/test/ca.private.key"
    },
    "max_connections": 64,
    "limit_req_body_in_bytes": 10485760,
    "num_workers": 1,
    "tcp_fastopen_queue_size": 104,
    "auth_keystore": {
        "url":"https://localhost:8008/jwks",
        "ca_path": "media/data/certs/test/ca.crt",
        "ca_form": "PEM"
    },
    "databases": [
        {
            "alias": "db_server_1",
            "db_name": "test_ecommerce_media",
            "max_connections": 5,
            "idle_timeout": 20,
            "bulk_query_limit_kb": 2,
            "credential": {
                "hierarchy": ["backend_apps","databases","media_service"],
                "filepath":"common/data/secrets.json"
            }
        },
        {
            "alias": "db_test_migration",
            "db_name": "test_ecommerce_media",
            "max_connections": 1,
            "idle_timeout": 20,
            "bulk_query_limit_kb": 2,
            "credential": {
                "hierarchy": ["backend_apps","databases","test_site_dba"],
                "filepath":"common/data/secrets.json"
            }
        }
    ],
    "storages": [
        {
            "alias":"localfs",
            "base_path": "filespace/test",
            "ops": {
                "mkdir" : "app_storage_localfs_mkdir",
                "rmdir" : "app_storage_localfs_rmdir",
                "open" : "app_storage_localfs_open",
                "close": "app_storage_localfs_close",
                "read" : "app_storage_localfs_read",
                "write": "app_storage_localfs_write",
                "seek" : "app_storage_localfs_seek"
            }
        }
    ],
    "num_rpc_consumers": 1,
    "rpc":[
        {
            "alias": "app_mqbroker_1",
            "bindings": [
                {
                    "queue": "rpc_media_complete_multipart_upload",
                    "exchange": "rpc-default-allapps",
                    "routing_key": "rpc.media.complete_multipart_upload",
                    "durable": true,
                    "reply": {
                        "queue": {
                            "pattern":"rpc.reply.media.mp_done.prof_id.%u",
                            "render_fn":"api_complete_multipart_upload__render_rpc_replyq"
                        },
                        "correlation_id": {
                            "pattern":"rpc.media.mp_done.corr_id.%s",
                            "render_fn":"api_complete_multipart_upload__render_rpc_corr_id"
                        },
                        "task_handler": "api_complete_multipart_upload__rpc_task_handler",
                        "durable": true,
                        "ttl_sec": 180
                    }
                }
            ],
            "attributes": {
                "vhost":"/",
                "max_channels": 128,
                "timeout_secs": 30,
                "max_kb_per_frame": 35
            },
            "credential": {
                "hierarchy": ["amqp_broker", 1],
                "filepath":"common/data/secrets.json"
            }
        }
    ],
    "tmp_buf": {
        "path": "tmp/buffer/media/test",
        "threshold_in_bytes": 102400
    }
}
